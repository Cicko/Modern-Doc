<!DOCTYPE HTML>
<html>
<head>
  <!-- <script src="https://code.jquery.com/jquery-3.2.1.min.js"></script> -->
</head>
<body>
  <div class="ui segment">
  <div class="ui dimmer create">
    <div class="ui indeterminate text loader">Creating book</div>
  </div>
  <div class="ui dimmer install">
    <div class="ui indeterminate text loader">Installing and preparing files</div>
  </div>
  <p></p>

  <form class="ui form" style="margin: 5em 5em 5em 5em;">
  <h2 class="ui dividing header">Create a new document</h4>
  <div class="field">
    <label>Title</label>

      <div class="field">
        <input type="text" id="title" name="title" placeholder="Sample book">
      </div>
  </div>
  <div class="two fields" style="margin: 0em 0em 0em 0em;">
    <div class="grouped fields">
   <label for="fruit"> Select template:</label>
   <div class="field">
     <div class="ui radio checkbox">
       <input type="radio" name="fruit" checked="" tabindex="0" class="hidden" value="book" id="type_book" onchange="typeChanged(this.id);">
       <label>Book</label>
     </div>
   </div>
   <div class="field">
     <div class="ui radio checkbox">
       <input type="radio" name="fruit" tabindex="0" class="hidden" value="api" id="api" onchange="typeChanged(this.id);">
       <label>API</label>
     </div>
   </div>
   <div class="field">
     <div class="ui radio checkbox">
       <input type="radio" name="fruit" tabindex="0" class="hidden" value="faq" id="faq" onchange="typeChanged(this.id);">
       <label>FAQ</label>
     </div>
   </div>
   <div class="field">
     <div class="ui radio checkbox">
       <input type="radio" name="fruit" tabindex="0" class="hidden" value="other" id="other" onchange="typeChanged(this.id);" >
       <label>Other</label>
     </div>
   </div>
 </div>
 <div class="field templateName">
   <label>Template name <i class=" help icon link" data-content="It have to be npm package" data-variation="small"></i></label>
     <div class="field">
       <input type="text" name="template" id="template_name" placeholder="book">
     </div>
 </div>
  </div>
  <h4 class="ui dividing header">Deployments <i class=" help icon link" data-content="Select all platforms where do you want to deploy" data-variation="small"></i></h4>
  <select class="ui fluid search dropdown" multiple="">
    <option value="">Deployment</option>
    <option value="heroku">Heroku</option>
    <option value="gh-pages">Github Pages</option>
    <option value="gitbook">Gitbook</option>
    <option value="server">Server</option>
  </select>
  <div class="ui sub header server">Server/s</div>
  <div class="ui server fluid multiple search selection dropdown" id="deploys">
    <input name="tags" type="hidden">
    <i class="dropdown icon"></i>
    <div class="default text">Insert IP addresses or domains (examples: 80.54.1.1, www.brocolito.io, chuchu.foo)</div>
    <div class="menu">
    </div>
  </div>
   <div class="ui divider"></div>
  <div class="ui button" tabindex="0" onclick="createBook();">Create book</div>
  <div class="ui button" tabindex="0" onclick="install();">Install</div>
</form>
</div>

<link rel="stylesheet" type="text/css" href="semantic/dist/semantic.css">
<script>
  if (typeof module === 'object') {window.module = module; module = undefined;}
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
<script src="semantic/dist/semantic.js"></script>
<!-- Insert this line after script imports -->
<script>
  if (window.module) module = window.module;
</script>
<script>
const gitbook_setup = require('gitbook-setup');

var other_type_checked = false;
var actual_type_checked = "book";
var server_deployment = false;
var deployments;
var servers;

function typeChanged (element_id) {
  actual_type_checked = element_id;
  if (element_id == "other") {
    $('.templateName').transition('fade in')
    other_type_checked = true;
  }
  else if (other_type_checked){
    other_type_checked = false;
    $('.templateName').transition('fade out')
  }
}

$('.templateName').transition('fade out')
$('.server').transition('fade out')
$('.ui.radio.checkbox').checkbox();
$('select.dropdown').dropdown();

$('.help.icon.link')
  .popup()
;

$('.ui.fluid.search.dropdown')
  .dropdown({
    onChange: function(value, text, $selectedItem) {
      deployments = value;
      if (server_deployment && !value.includes('server')) {
        server_deployment = false;
        $('.server').transition('fade out')
      }

      if ($selectedItem == "heroku") {

      }
      if ($selectedItem == "server") {
        server_deployment = true;
        $('.server').transition('fade in')
      }
    }
  });

$('#deploys').dropdown({
  allowAdditions: true,
  onChange: function(value, text, $selectedItem) {
    servers = value;
  }
});


function createBook() {
  $('.dimmer.create.ui').addClass('active')
  var title = $('#title')[0].value;
  var type = actual_type_checked;
  var template;
  if (type == "other") {
    template = $('#template_name')[0].value;
  }
  else {
    template = type;
  }
  if (server_deployment) {
    deployments = deployments.concat(servers.split(","));
  }

  var info = {
    'name': title,
    'template': template,
    'deploys': deployments
  }

  console.log(info);

  gitbook_setup.create(info, function(err) {
    if (err) console.log(err);
    else $('.dimmer.create.ui').removeClass('active')
  })
}

function install () {
  $('.dimmer.install.ui').addClass('active')
  gitbook_setup.install((err) => {
    if (err) console.log(err);
    else {
      $('.dimmer.install.ui').removeClass('active')
    }
  })
}







</script>


</body>


</html>
